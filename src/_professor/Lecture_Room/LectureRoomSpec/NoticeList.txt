import { useEffect, useState } from "react";
import { Card, CardBody, Col, Container, Row, Button, Pagination } from "react-bootstrap";
import { API_BASE_URL } from "../../../../public/config/config";
import { useAuth } from "../../../../public/context/UserContext";
import { useLocation, useNavigate } from "react-router-dom";
import axios from "axios";

function App() {
    const { user } = useAuth();
    const [post, setPost] = useState([]);//content
    const [page, setPage] = useState(1);
    const [pageInfo, setPageInfo] = useState({});
    const navigate = useNavigate();
    const itemPerPage = 10;
    const totalPages = Math.ceil(post.length / itemPerPage)
    const pageRange = 10;
    const currentItems = post.slice(
        (page - 1) * itemPerPage,
        page * itemPerPage
    )
    useEffect(() => {
        const url = `${API_BASE_URL}/notice/List`
        axios.get(url, {
            params: {
                email: user.email,
                page: page,
                size: 10
            }
        })
            .then((res) => {
                console.log(res?.data);

                setPost(res.data.content)
                setPageInfo({
                    ...res.data
                })

            })
            .catch((e) => {
                console.log(e);
            })
    }, [page])
    console.log(post);
    console.log(pageInfo);

    const specificPage = (item) => {
        console.log(item);
        navigate("/notionlistspec", { state: item.id });
    }

    const ChangePage = (page) => {
        if (page >= 0 && page < pageInfo.totalPages)
            setPage(page);
    }

    const startPage = Math.max(1, page - Math.floor(pageRange / 2));
    const endPage = Math.min(totalPages, startPage + pageRange - 1);
    return (
        <Container style={{ maxWidth: "700px", marginTop: "2rem" }}>

            <Row className="mb-3 align-items-center" style={{ height: "auto" }}>
                <Col><h4> 공지사항</h4></Col>
                <Col xs="auto">
                    <Button variant="primary" onClick={() => navigate("/noticep")}>
                        공지 작성
                    </Button>
                </Col>
            </Row>

            <Row>
                <Col>
                    {post.length > 0 ? (
                        post.map((item) => (
                            <Card
                                key={item.id}
                                onClick={() => specificPage(item)}
                                className="mb-3 shadow-sm"
                                style={{ cursor: "pointer" }}
                            >
                                <CardBody>
                                    <h5 className="fw-bold mb-2">{item.title}</h5>
                                    <div className="d-flex justify-content-between text-muted" style={{ fontSize: "14px" }}>
                                        <span>{item.username}</span>
                                        <span>{new Date(item.createdAt).toLocaleDateString()}</span>
                                    </div>
                                </CardBody>
                            </Card>
                        ))
                    )
                        : (
                            <div className="text-center mt-5 text-muted">
                                게시물이 존재하지 않습니다.
                            </div>
                        )}
                </Col>
            </Row>

            <div className="d-flex justify-content-center mt-4">
                <Pagination>
                    <Pagination.First
                        disabled={page === 1}
                        onClick={() => setPage(page - 1)}
                    />

                    {/* <Pagination.Prev
                        onClick={() => ChangePage(page - 1)}
                    /> */}

                    {[...Array(endPage - startPage + 1)].map((_, i) => {
                        const pageNumber = startPage + i;
                        return (
                            <Pagination.Item
                                key={pageNumber}
                                active={page === pageNumber}
                                onClick={() => setPage(pageNumber)}
                            >
                                {pageNumber}
                            </Pagination.Item>
                        );
                    })}
                    {/* <Pagination.Next
                        disabled={pageInfo?.last}
                        onClick={() => ChangePage(page + 1)}
                    /> */}

                    <Pagination.Last
                        disabled={page === totalPages}
                        onClick={() => setPage(page + 1)}
                    />

                </Pagination>
            </div>




        </Container>
    );
}
export default App;
